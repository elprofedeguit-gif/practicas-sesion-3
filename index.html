<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PrÃ¡cticas guiadas â€“ SesiÃ³n 3</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#141414;
  --green:#00b84f;
  --green-light:#6aff9c;
  --violet:#C9A9FF;
  --yellow:#E0BA30;
  --orange:orange;
}
body{ margin:0; background:var(--bg); color:#fff; font-family:Arial,sans-serif; }
.page{ min-height:100vh; display:flex; flex-direction:column; align-items:center; }

.header{ display:flex; flex-direction:column; align-items:center; margin-top:20px; }
.header img{ width:150px; max-width:80%; margin-bottom:12px; }
h1{ color:#9effa0; margin:0; font-weight:600; text-align:center; }
.subtitle{ color:var(--violet); font-style:italic; font-size:clamp(14px,4vw,16px); margin:6px 0 24px; }

.container{ max-width:720px; width:100%; padding:16px; text-align:center; box-sizing:border-box; }
.menu-btn{
  width:100%; max-width:420px; background:#1e1e1e;
  border:1.5px solid var(--green); border-radius:12px;
  padding:16px; margin:12px auto; cursor:pointer;
  color:#fff; font-size:16px; font-weight:600;
}
.menu-btn:active{ transform:scale(.97); }
.section{ display:none; }

.circle{ width:150px; height:150px; border-radius:50%; background:#222; margin:32px auto 24px; }
.circle.on{ background:var(--green); }

.controls{ margin:16px auto; max-width:300px; }
input[type=range]{ width:100%; }

button.control{
  background:var(--green); color:#000; border:none; border-radius:12px;
  padding:12px 26px; margin:10px; cursor:pointer;
  font-size:15px; font-weight:600;
}
button.control:active{ transform:scale(.96); }
button.control.playing{ background:var(--green-light); }

.progression{ display:flex; justify-content:space-between; margin:20px 0 24px; }
.chord{
  flex:1; margin:0 4px; padding:12px 6px; border-radius:10px;
  background:#222; cursor:pointer; font-size:14px;
}
.chord.selected{ outline:2px solid var(--violet); }
.chord.active{ background:var(--green); color:#000; }

.count{ display:flex; justify-content:center; font-size:42px; margin-bottom:20px; }
.count span{ width:36px; opacity:.3; }
.count .one{ color:var(--yellow); opacity:1; }
.count .other{ color:var(--orange); opacity:1; }

@media(max-width:600px){ .count{ font-size:34px; } }
</style>
</head>

<body>
<div class="page">

<div class="header">
  <img src="https://static.wixstatic.com/media/b4a607_0927246f3864402c8d6d2d56723b8bba~mv2.png">
  <h1>PrÃ¡cticas guiadas â€“ SesiÃ³n 3</h1>
  <div class="subtitle">Cuando la mÃºsica comienza</div>
</div>

<div class="container section" id="menu" style="display:block">
  <button class="menu-btn" onclick="show('dig1')">â–¶ DigitaciÃ³n â€“ Ejercicio 1</button>
  <button class="menu-btn" onclick="show('dig2')">â–¶ DigitaciÃ³n â€“ Ejercicio 2</button>
  <button class="menu-btn" onclick="show('letitbe')">â–¶ Let It Be â€“ PrÃ¡ctica de acordes</button>
</div>

<div class="container section" id="dig1">
  <h2>DigitaciÃ³n â€“ Ejercicio 1</h2>
  <div class="subtitle">FÃ³rmula 1â€“2â€“3â€“4</div>
  <div class="circle" id="circle1"></div>
  <div class="controls">
    BPM: <span id="bpm1Val">30</span>
    <input type="range" min="20" max="50" value="30" id="bpm1">
  </div>
  <button class="control" id="playDig1" onclick="toggleDig1()">Play / Stop</button>
  <button class="control" onclick="back()">Volver</button>
</div>

<div class="container section" id="dig2">
  <h2>DigitaciÃ³n â€“ Ejercicio 2</h2>
  <div class="subtitle">FÃ³rmula 1â€“3â€“4â€“2</div>
  <div class="circle" id="circle2"></div>
  <div class="controls">
    BPM: <span id="bpm2Val">30</span>
    <input type="range" min="20" max="50" value="30" id="bpm2">
  </div>
  <button class="control" id="playDig2" onclick="toggleDig2()">Play / Stop</button>
  <button class="control" onclick="back()">Volver</button>
</div>

<div class="container section" id="letitbe">
  <h2>Let It Be â€“ PrÃ¡ctica de acordes</h2>

  <div class="progression">
    <div class="chord">A</div><div class="chord">%</div>
    <div class="chord">E</div><div class="chord">%</div>
    <div class="chord">A</div><div class="chord">%</div>
    <div class="chord">D</div><div class="chord">%</div>
  </div>

  <div class="count">
    <span>1</span><span>2</span><span>3</span><span>4</span>
  </div>

  <div class="controls">
    BPM: <span id="bpmVal">45</span>
    <input type="range" min="45" max="60" value="45" id="bpm">
  </div>

  <button class="control" id="playLet" onclick="toggleLet()">Play / Stop</button>
  <button class="control" onclick="back()">Volver</button>
</div>

</div>

<script>
/* ===== AUDIO ===== */
let ctx=null;
function ensureAudio(){
  if(!ctx){
    ctx=new (window.AudioContext||window.webkitAudioContext)();
  }
}
function clickSound(vol){
  ensureAudio();
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.frequency.value=900;
  g.gain.value=vol;
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+0.05);
}

/* ===== NAVEGACIÃ“N ===== */
function show(id){
  stopAll();
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}
function back(){ stopAll(); show('menu'); }

/* ===== DIGITACIONES ===== */
const bpm1=document.getElementById("bpm1");
const bpm1Val=document.getElementById("bpm1Val");
bpm1.oninput=()=>bpm1Val.textContent=bpm1.value;
let t1=null,p1=false;
function toggleDig1(){
  if(p1){ stopDig1(); return; }
  ensureAudio(); clickSound(.2);
  p1=true; playDig1.classList.add("playing");
  pulse1(); t1=setInterval(pulse1,60000/bpm1.value);
}
function pulse1(){
  circle1.classList.add("on"); clickSound(.2);
  setTimeout(()=>circle1.classList.remove("on"),80);
}
function stopDig1(){ clearInterval(t1); p1=false; playDig1.classList.remove("playing"); }

const bpm2=document.getElementById("bpm2");
const bpm2Val=document.getElementById("bpm2Val");
bpm2.oninput=()=>bpm2Val.textContent=bpm2.value;
let t2=null,p2=false;
function toggleDig2(){
  if(p2){ stopDig2(); return; }
  ensureAudio(); clickSound(.2);
  p2=true; playDig2.classList.add("playing");
  pulse2(); t2=setInterval(pulse2,60000/bpm2.value);
}
function pulse2(){
  circle2.classList.add("on"); clickSound(.2);
  setTimeout(()=>circle2.classList.remove("on"),80);
}
function stopDig2(){ clearInterval(t2); p2=false; playDig2.classList.remove("playing"); }

/* ===== LET IT BE (FIX MÃ“VIL DEFINITIVO) ===== */
const bpm=document.getElementById("bpm");
const bpmVal=document.getElementById("bpmVal");
bpm.oninput=()=>bpmVal.textContent=bpm.value;

const countSpans=document.querySelectorAll(".count span");
const chords=[...document.querySelectorAll(".chord")];
let selectedChord=0;
chords.forEach((c,i)=>{
  c.onclick=()=>{
    chords.forEach(x=>x.classList.remove("selected"));
    c.classList.add("selected"); selectedChord=i;
  };
});

let timer=null, playing=false, beat=0, chordIndex=0;

function highlight(i){
  countSpans.forEach(s=>s.className="");
  if(i===0) countSpans[0].classList.add("one");
  else countSpans[i].classList.add("other");
}

function toggleLet(){
  if(playing){ stopLet(); return; }

  ensureAudio();
  /* ðŸ”¥ TIEMPO 1 AUDIBLE DENTRO DEL CLICK (CLAVE MÃ“VIL) */
  beat=0; chordIndex=selectedChord;
  highlight(0);
  clickSound(.25);   // ESTE ES EL â€œ1â€

  let step=1;
  const interval=60000/bpm.value;

  timer=setInterval(()=>{
    highlight(step);
    clickSound(.25);
    step++;
    if(step===4){
      clearInterval(timer);
      startLet(interval);
    }
  }, interval);
}

function startLet(interval){
  playing=true; playLet.classList.add("playing");
  beat=0;
  timer=setInterval(()=>{
    highlight(beat);
    if(beat===0){
      chords.forEach(c=>c.classList.remove("active"));
      chords[chordIndex].classList.add("active");
      chordIndex=(chordIndex+1)%chords.length;
      clickSound(.3);
    } else clickSound(.15);
    beat=(beat+1)%4;
  }, interval);
}

function stopLet(){
  clearInterval(timer); playing=false;
  playLet.classList.remove("playing");
}

function stopAll(){
  stopDig1(); stopDig2(); stopLet();
}
</script>
</body>
</html>
